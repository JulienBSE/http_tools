---
alwaysApply: true
---
# PRD â€” GÃ©nÃ©rateur de SchÃ©mas Ã‰lectriques Draw.io (React + Node.js)

## ğŸ¯ Objectif du produit

DÃ©velopper une application web interne permettant de gÃ©nÃ©rer automatiquement des schÃ©mas Ã©lectriques au format `.drawio` Ã  partir :

- dâ€™un **fichier JSON** fourni par l'utilisateur (liste de points),
- dâ€™un **modÃ¨le Draw.io** existant (fichier XML),
- dâ€™informations stockÃ©es dans une **base SQLite** (cartes automates, propriÃ©tÃ©s),
- et de rÃ¨gles dâ€™affectation identiques Ã  celles du projet Python dâ€™origine.

Le but est de reproduire fidÃ¨lement la logique du projet Python existant mais en **full JavaScript**, avec une **interface React** pÃ©dagogique et un **backend Node.js minimaliste**.

---

# ğŸ—ï¸ Architecture globale

## Frontend (React + Vite)

Interface utilisateur :

- Upload dâ€™un fichier JSON
- SÃ©lection du matÃ©riel (cartes automates, options projet)
- ParamÃ¨tres du projet (nom, automate, etc.)
- Bouton **GÃ©nÃ©rer**
- TÃ©lÃ©chargement du fichier `.drawio` gÃ©nÃ©rÃ©

Le code React doit Ãªtre :

- **TrÃ¨s commentÃ©**
- En **franÃ§ais**
- Variables et fonctions en **franÃ§ais**
- Explications renforcÃ©es sur :
  - hooks React (useState, useEffectâ€¦)
  - handling des formulaires
  - upload de fichiers
  - fetch
  - composant contrÃ´lÃ© vs non contrÃ´lÃ©
  - re-render et immutabilitÃ©

## Backend (Node.js + Express)

Backend reÃ§oit :

- fichier JSON
- rÃ©fÃ©rences des cartes sÃ©lectionnÃ©es
- paramÃ¨tres projet

Puis exÃ©cute :

1. **Filtrer les points** selon type (DI, DO, AI, AO, COMâ€¦)
2. **Lire SQLite** pour rÃ©cupÃ©rer info des cartes
3. **Ordonner les cartes** selon : Automate â†’ AI â†’ DI â†’ DO â†’ AO
4. **VÃ©rifier la capacitÃ© totale**
5. **Affecter les points aux cartes**
6. **GÃ©nÃ©rer le XML Draw.io**
7. **Envoyer un fichier `.drawio` en tÃ©lÃ©chargement**

### Base SQLite

Utiliser **better-sqlite3** (rapide, synchrone, simple).

---

# ğŸ“Œ Exigences fonctionnelles

Le site web intrne sera vouÃ© a acceuillir plusieurs outil. Il faut donc un menu. Le premier outil s'appel Alibalek (gÃ©nÃ©rateur de schÃ©ma)

## 1. Upload JSON

Le frontend doit permettre :

- drag & drop ou input file
- validation de format
- chargement dans un `useState`

## 2. SÃ©lection du matÃ©riel

Le frontend doit permettre :

- d'interroger la BDD pour afficher toutes les cartes disponibles
- de sÃ©lectionner les cartes qui seront utilisÃ©es dans le schÃ©ma

## 3. GÃ©nÃ©ration du schÃ©ma (backend)

### Ã‰tape 1 â€” Filtrage des points

### Ã‰tape 2 â€” RÃ©cupÃ©rer les cartes depuis SQLite

### Ã‰tape 3 â€” Ordonner les cartes

### Ã‰tape 4 â€” VÃ©rifier capacitÃ©

### Ã‰tape 5 â€” Affecter points

### Ã‰tape 6 â€” GÃ©nÃ©rer XML Draw.io

### Ã‰tape 7 â€” Retour du fichier

---

# ğŸ¨ Exigences frontend (React)

## GÃ©nÃ©ral

- Code **100% en franÃ§ais**
- Beaucoup de **commentaires pÃ©dagogiques**
- Interfaces simples

## Composants React attendus :

### Page Upload JSON

- composant dâ€™upload (`<input type="file" />`)
- explications dÃ©taillÃ©es sur :
  - `event.target.files`
  - `FormData`
  - stockage dans Ã©tat React

### Page Configuration

- liste des cartes (venant du backend)
- sÃ©lection des cartes
- paramÃ¨tres projet
- bouton â€œGÃ©nÃ©rerâ€

### Gestion du tÃ©lÃ©chargement

- appel `fetch("/generate")`
- conversion en blob
- crÃ©ation dâ€™un lien de tÃ©lÃ©chargement

---

# ğŸ“¡ API Backend

## GET `/cartes`

Retourne la liste des cartes disponibles dans SQLite.

## POST `/generate`

ReÃ§oit :

- fichier JSON (multipart)
- champs `refs` (liste des rÃ©fÃ©rences de cartes)
- champs `params` (donnÃ©es projet)

Retour :

- fichier `.drawio`

---

# ğŸ”§ Exigences techniques backend

### Node / Express, dÃ©pendances minimales :

- express
- express-fileupload
- better-sqlite3
- xmlbuilder2 ou fast-xml-parser

### Style du code :

- franÃ§ais
- commentaires dÃ©taillÃ©s dans chaque module
- explication de lâ€™algorithme
- aucune dÃ©pendance inutile

---

# ğŸ“ Notes importantes pour Cursor

Cursor doit :

- utiliser des **noms de variables en franÃ§ais**
- utiliser des **noms de fonctions en franÃ§ais**
- commenter **chaque fonction** et **chaque Ã©tape tricky**
- commenter **beaucoup plus le React**, notamment :
  - useState / useEffect
  - gestion des fichiers
  - immutabilitÃ©
  - gestion du fetch
- Ã©viter toute dÃ©pendance lourde